Термины и определения
=====================

Клиент API (Клиент) - организация заключившая договор с Национальным кредитным бюро 
на использоавние API.

ИС НКБ - информационная система Национального кредитного бюро.

ИС Клиента - информационная система Клиента.


API
===

Обмен между ИС НКБ и ИС Клиента осуществляется по протоколу HTTPS. 

Формат данных обмена - JSON. 

Параметры в запроса должны быть в кодировке UTF-8 и закодированы 
для передачи в URL (http://en.wikipedia.org/wiki/Percent-encoding).

ИС Клиента выступает инициатором обмена и является клиентом по отношению к 
серверу ИС НКБ.

При ответе на запрос, ИС НКБ может выставить один из перечисленных HTTP статусов:

* 200 OK: Запрос обработан успешно. Тело ответа содержит запрашиваемые данные.
* 400 Bad Request: Запрос содержит некорректные данные.
* 403 Forbidden: Сервер не может авторизовать клиента для выполнения запроса.
* 404 Not Found: Запрашиваемый ресурс не найден.
* 405 Method Not Allowed: Неподдерживаемый HTTP метод.
* 500 Internal Server Error: На сервере произошла ошибка.
* 502 Bad Gateway: Сервер недоступен или обновляется.
* 503 Service Unavailable: Сервер доступен, но перегружен запросами. Необходимо 
повторить запрос позже.


Аутентификация
--------------

HTTP Basic over HTTPS


Проверка на аффилированность
----------------------------

### Запрос

`GET /api/connections`

### Параметры

* q [строка, обязателен] - идентификатор организации, например ОКПО, ОГРН, ИНН.

Для осуществления проверки необходимо передать идентификаторы двух или более 
организаций, при этом по каждой организации ожидается только один идентификатор.

Пример строки запроса: `?q=60510227&q=1117746960704&q=7703561549`

Значения идентификаторов можно передать в одном параметре - для этого 
необходимо разделить из символом перевода строки (ASCII код `0x0A`).

Пример строки запроса: `?q=60510227%0A1117746960704%0A7703561549`

### Ответ

```json
{
    "connections": [
        ["<идентификатор11>", "<идентификатор12>", ..., "<идентификатор1N>"],
        ["<идентификатор21>", "<идентификатор22>", ..., "<идентификатор2M>"],
        ...
    ],
    "validation": {
        "q": {
            "<идентификаторX>": {"status": "<статусX>", "info": <инфоX>},
            "<идентификаторY>": {"status": "<статусY>", "info": <инфоY>},
            ...
        }
    }
}
```

Ответ содержит набор групп аффилированных лиц `"connections"`.
В каждой группе перечислены идентификаторы организаций, между которыми были 
выявлены признаки аффилированности. Каждый идентификатор может принадлежать только 
одной группе аффилированных лиц.

В примерах используются идентификаторы: 

* 60510227 - ООО "Газэнергоинформ", ОГРН 1097746173249, ИНН 7728696530, ОКПО *60510227*
* 1117746960704 - ЗАО "Спецстрой-Лизинг", ОГРН *1117746960704*, ИНН 7726687266, ОКПО 37276659
* 7703561549 - ООО "Фабрикант.ру", ОГРН: 1057748006139, ИНН *7703561549*, ОКПО 78522076
* 1047796089450 - ООО "ЮВЕНТА", ОГРН *1047796089450*, ИНН 7724505200, ОКПО 72066223
* 1127746519900 - ООО "НАЛПОИНТЕР", ОГРН *1127746519900*, ИНН 7704811150, ОКПО 9933928
* 1057747690890 - ЗАО "НКБ", ОГРН *1057747690890*, ИНН 7714611569, ОКПО 78486593

Если в запросе есть некорректные идентификаторы, ответ будет содержать объект
`"validation"` с описанием выявленных проблем.

Описание проблемы представляет собой объект с двумя полями - обязательной
строкой `"status"` и опциональным объектом `"info"`. Описания проблем с
идентификаторами организаций размещаются во вложенном объекте `"q"`.

Для каждого некорректного идентификатора, описание проблемы представляет собой
один из следующих объектов:

* `{"status": "not found"}` - идентификатор не найден в ИС НКБ. Идентификатор не участвует в проверке.
* `{"status": "multiple"}` - по идентификатору найдено несколько записей в ИС НКБ.
Идентификатор не участвует в проверке.
* `{"status": "alias", "info": "<идентификатор>"}` - идентификатор встречается в
запросе больше одного раза или является иным уникальным идентификатором записи
участвующей в проверке. Объект `"info"` содержит строку-идентификатор этой записи.


### Пример №1: Выявлены признаки аффилированности среди всех участников

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=60510227&q=1117746960704&q=7703561549`

```json
{
    "connections": [
        ["60510227", "1117746960704", "7703561549"]
    ]
}
```

Запрос на проверку аффилированности между организациями 

ООО "Газэнергоинформ", ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"

выявил одну группу аффилированных лиц, содержащую все запрошенные идентификаторы.


### Пример №2: Выявлены признаки аффилированности среди некоторых участников

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704&q=7703561549&q=1127746519900`

```json
{
    "connections": [
        ["1117746960704", "7703561549"]
    ]
}
```

Запрос на проверку аффилированности между организациями 

ЗАО "Спецстрой-Лизинг", ООО "Фабрикант.ру" и ООО "НАЛПОИНТЕР"

выявил одну группу аффилированных лиц:

ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"


### Пример №3: Выявлено несколько групп с признаками аффилированности

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704&q=7703561549&q=1127746519900&q=1057747690890`

```json
{
    "connections": [
        ["1117746960704", "7703561549"],
        ["1127746519900", "1057747690890"],
    ]
}
```

Запрос на проверку аффилированности между организациями 

ЗАО "Спецстрой-Лизинг", ООО "Фабрикант.ру", ООО "НАЛПОИНТЕР" и ЗАО "НКБ"

выявил две группы аффилированных лиц:

ЗАО "Спецстрой-Лизинг" и ООО "Фабрикант.ру"
ООО "НАЛПОИНТЕР" и ЗАО "НКБ"


### Пример №4: Признаки аффилированности не выявлены

`GET https://www.creditnet.ru/nkbrelation/api/connections?q=1117746960704&q=1047796089450&q=1127746519900`

```json
{
}
```

Запрос на проверку аффилированности между тремя организациями с идентификаторами:

ЗАО "Спецстрой-Лизинг", ООО "ЮВЕНТА" и ООО "НАЛПОИНТЕР"

не выявил признаков аффилированности - ответ не содержит массива `connections`

